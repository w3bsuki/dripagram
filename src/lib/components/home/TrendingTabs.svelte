<script lang="ts">
	import { Clock, TrendingUp, MapPin, Heart, Eye, Star } from '@lucide/svelte';
	import * as Tabs from '$lib/components/ui/tabs';

	let currentTab = $state('new');

	// Sample data for different sections
	let newProducts = [
		{
			id: 1,
			title: '–ù–æ–≤ iPhone 15',
			price: 1299,
			image: 'https://picsum.photos/200/250?random=10',
			timeAgo: '5 –º–∏–Ω',
			location: '–°–æ—Ñ–∏—è',
			likes: 3,
			views: 12,
		},
		{
			id: 2,
			title: '–í–∏–Ω—Ç–∏–¥–∂ –∫–æ–∂–µ–Ω–∞ —á–∞–Ω—Ç–∞',
			price: 89,
			image: 'https://picsum.photos/200/250?random=11',
			timeAgo: '12 –º–∏–Ω',
			location: '–ü–ª–æ–≤–¥–∏–≤',
			likes: 7,
			views: 24,
		},
		{
			id: 3,
			title: '–°–ø–æ—Ä—Ç–Ω–∏ –º–∞—Ä–∞—Ç–æ–Ω–∫–∏ Nike',
			price: 150,
			image: 'https://picsum.photos/200/250?random=12',
			timeAgo: '28 –º–∏–Ω',
			location: '–í–∞—Ä–Ω–∞',
			likes: 12,
			views: 45,
		},
		{
			id: 4,
			title: '–ï–ª–µ–≥–∞–Ω—Ç–Ω–∞ —Ä–æ–∫–ª—è',
			price: 65,
			image: 'https://picsum.photos/200/250?random=13',
			timeAgo: '1 —á',
			location: '–°–æ—Ñ–∏—è',
			likes: 8,
			views: 33,
		},
	];

	let popularProducts = [
		{
			id: 5,
			title: 'MacBook Pro M2',
			price: 2299,
			image: 'https://picsum.photos/200/250?random=14',
			likes: 156,
			views: 1240,
			engagement: '98%',
		},
		{
			id: 6,
			title: '–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏ —á–∞—Å–æ–≤–Ω–∏–∫',
			price: 450,
			image: 'https://picsum.photos/200/250?random=15',
			likes: 89,
			views: 567,
			engagement: '92%',
		},
		{
			id: 7,
			title: 'PlayStation 5',
			price: 599,
			image: 'https://picsum.photos/200/250?random=16',
			likes: 234,
			views: 1890,
			engagement: '95%',
		},
		{
			id: 8,
			title: 'Canon –∫–∞–º–µ—Ä–∞',
			price: 890,
			image: 'https://picsum.photos/200/250?random=17',
			likes: 67,
			views: 445,
			engagement: '87%',
		},
	];

	let nearbyProducts = [
		{
			id: 9,
			title: '–í–µ–ª–æ—Å–∏–ø–µ–¥ Trek',
			price: 399,
			image: 'https://picsum.photos/200/250?random=18',
			distance: '0.5 –∫–º',
			location: '–∫–≤. –õ–æ–∑–µ–Ω–µ—Ü',
			seller: '–ì–µ–æ—Ä–≥–∏ –ú.',
			rating: 4.9,
		},
		{
			id: 10,
			title: '–ö–∞—Ñ–µ–º–∞—à–∏–Ω–∞',
			price: 89,
			image: 'https://picsum.photos/200/250?random=19',
			distance: '1.2 –∫–º',
			location: '–∫–≤. –°—Ç—É–¥–µ–Ω—Ç—Å–∫–∏',
			seller: '–ú–∞—Ä–∏—è –ü.',
			rating: 4.7,
		},
		{
			id: 11,
			title: '–î–µ—Ç—Å–∫–∞ –∫–æ–ª–∏—á–∫–∞',
			price: 179,
			image: 'https://picsum.photos/200/250?random=20',
			distance: '2.1 –∫–º',
			location: '–∫–≤. –ú–ª–∞–¥–æ—Å—Ç',
			seller: '–ê–Ω–Ω–∞ –°.',
			rating: 5.0,
		},
		{
			id: 12,
			title: '–õ–∞–ø—Ç–æ–ø Lenovo',
			price: 699,
			image: 'https://picsum.photos/200/250?random=21',
			distance: '3.5 –∫–º',
			location: '–∫–≤. –í–∏—Ç–æ—à–∞',
			seller: '–ü–µ—Ç—ä—Ä –î.',
			rating: 4.8,
		},
	];

	function formatNumber(num: number): string {
		if (num >= 1000) {
			return (num / 1000).toFixed(1) + 'k';
		}
		return num.toString();
	}
</script>

<section class="bg-white py-12 md:py-16">
	<div class="mx-auto max-w-7xl px-4">
		<!-- Section Header -->
		<div class="mb-12 text-center">
			<h2 class="mb-4 text-2xl font-bold text-gray-900 md:text-3xl">–û—Ç–∫—Ä–∏–π –Ω–∞–π-–¥–æ–±—Ä–æ—Ç–æ</h2>
			<p class="text-lg text-gray-600">–ù–æ–≤–∏ –æ–±—è–≤–∏, –ø–æ–ø—É–ª—è—Ä–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏ –∏ –Ω–∞—Ö–æ–¥–∫–∏ –≤ –±–ª–∏–∑–æ—Å—Ç –¥–æ —Ç–µ–±</p>
		</div>

		<!-- Tabs Component -->
		<Tabs.Root value={currentTab} onValueChange={(value) => (currentTab = value || 'new')}>
			<!-- Tab Navigation -->
			<Tabs.List class="mb-8 grid w-full grid-cols-3 rounded-xl bg-gray-100 p-1">
				<Tabs.Trigger
					value="new"
					class="flex items-center gap-2 rounded-lg px-4 py-3 font-medium transition-all data-[state=active]:bg-white data-[state=active]:shadow-sm"
				>
					<Clock size={16} />
					<span class="hidden sm:inline">–ù–∞–π-–Ω–æ–≤–∏</span>
					<span class="sm:hidden">–ù–æ–≤–∏</span>
				</Tabs.Trigger>
				<Tabs.Trigger
					value="popular"
					class="flex items-center gap-2 rounded-lg px-4 py-3 font-medium transition-all data-[state=active]:bg-white data-[state=active]:shadow-sm"
				>
					<TrendingUp size={16} />
					<span class="hidden sm:inline">–ü–æ–ø—É–ª—è—Ä–Ω–∏</span>
					<span class="sm:hidden">–¢–æ–ø</span>
				</Tabs.Trigger>
				<Tabs.Trigger
					value="nearby"
					class="flex items-center gap-2 rounded-lg px-4 py-3 font-medium transition-all data-[state=active]:bg-white data-[state=active]:shadow-sm"
				>
					<MapPin size={16} />
					<span class="hidden sm:inline">–í –±–ª–∏–∑–æ—Å—Ç</span>
					<span class="sm:hidden">–ë–ª–∏–∑–æ</span>
				</Tabs.Trigger>
			</Tabs.List>

			<!-- New Products Content -->
			<Tabs.Content value="new" class="mt-0">
				<div class="grid grid-cols-2 gap-4 md:grid-cols-4">
					{#each newProducts as product}
						<a
							href="/products/{product.id}"
							class="group overflow-hidden rounded-xl border border-gray-200 bg-white transition-all hover:shadow-lg"
						>
							<div class="relative aspect-[4/5] overflow-hidden">
								<img
									src={product.image}
									alt={product.title}
									class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
									loading="lazy"
								/>
								<!-- New badge -->
								<div
									class="absolute top-2 left-2 rounded-full bg-green-500 px-2 py-1 text-xs font-medium text-white"
								>
									–ù–æ–≤–æ
								</div>
								<!-- Time ago -->
								<div
									class="absolute top-2 right-2 rounded-full bg-black/50 px-2 py-1 text-xs text-white backdrop-blur-sm"
								>
									{product.timeAgo}
								</div>
							</div>
							<div class="p-3">
								<h3 class="mb-1 line-clamp-2 text-sm font-semibold text-gray-900">
									{product.title}
								</h3>
								<p class="mb-2 text-lg font-bold text-gray-900">{product.price} –ª–≤</p>
								<div class="flex items-center justify-between text-xs text-gray-500">
									<div class="flex items-center gap-1">
										<MapPin size={10} />
										<span>{product.location}</span>
									</div>
									<div class="flex items-center gap-2">
										<div class="flex items-center gap-1">
											<Heart size={10} />
											<span>{product.likes}</span>
										</div>
										<div class="flex items-center gap-1">
											<Eye size={10} />
											<span>{product.views}</span>
										</div>
									</div>
								</div>
							</div>
						</a>
					{/each}
				</div>
				<div class="mt-8 text-center">
					<a
						href="/products?sort=newest"
						class="bg-primary hover:bg-primary/90 inline-flex items-center gap-2 rounded-xl px-6 py-3 font-medium text-white transition-colors"
					>
						<Clock size={16} />
						–í–∏–∂ –≤—Å–∏—á–∫–∏ –Ω–æ–≤–∏ –æ–±—è–≤–∏
					</a>
				</div>
			</Tabs.Content>

			<!-- Popular Products Content -->
			<Tabs.Content value="popular" class="mt-0">
				<div class="grid grid-cols-2 gap-4 md:grid-cols-4">
					{#each popularProducts as product}
						<a
							href="/products/{product.id}"
							class="group overflow-hidden rounded-xl border border-gray-200 bg-white transition-all hover:shadow-lg"
						>
							<div class="relative aspect-[4/5] overflow-hidden">
								<img
									src={product.image}
									alt={product.title}
									class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
									loading="lazy"
								/>
								<!-- Popular badge -->
								<div
									class="absolute top-2 left-2 rounded-full bg-orange-500 px-2 py-1 text-xs font-medium text-white"
								>
									üî• –ü–æ–ø—É–ª—è—Ä–Ω–æ
								</div>
								<!-- Engagement -->
								<div
									class="absolute top-2 right-2 rounded-full bg-black/50 px-2 py-1 text-xs text-white backdrop-blur-sm"
								>
									{product.engagement}
								</div>
							</div>
							<div class="p-3">
								<h3 class="mb-1 line-clamp-2 text-sm font-semibold text-gray-900">
									{product.title}
								</h3>
								<p class="mb-2 text-lg font-bold text-gray-900">{product.price} –ª–≤</p>
								<div class="flex items-center justify-between text-xs text-gray-500">
									<div class="flex items-center gap-2">
										<div class="flex items-center gap-1">
											<Heart size={10} />
											<span>{formatNumber(product.likes)}</span>
										</div>
										<div class="flex items-center gap-1">
											<Eye size={10} />
											<span>{formatNumber(product.views)}</span>
										</div>
									</div>
									<div class="font-medium text-orange-600">–¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç</div>
								</div>
							</div>
						</a>
					{/each}
				</div>
				<div class="mt-8 text-center">
					<a
						href="/products?sort=popular"
						class="bg-primary hover:bg-primary/90 inline-flex items-center gap-2 rounded-xl px-6 py-3 font-medium text-white transition-colors"
					>
						<TrendingUp size={16} />
						–í–∏–∂ –Ω–∞–π-–ø–æ–ø—É–ª—è—Ä–Ω–∏—Ç–µ
					</a>
				</div>
			</Tabs.Content>

			<!-- Nearby Products Content -->
			<Tabs.Content value="nearby" class="mt-0">
				<div class="grid grid-cols-2 gap-4 md:grid-cols-4">
					{#each nearbyProducts as product}
						<a
							href="/products/{product.id}"
							class="group overflow-hidden rounded-xl border border-gray-200 bg-white transition-all hover:shadow-lg"
						>
							<div class="relative aspect-[4/5] overflow-hidden">
								<img
									src={product.image}
									alt={product.title}
									class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
									loading="lazy"
								/>
								<!-- Distance badge -->
								<div
									class="absolute top-2 left-2 rounded-full bg-blue-500 px-2 py-1 text-xs font-medium text-white"
								>
									üìç {product.distance}
								</div>
							</div>
							<div class="p-3">
								<h3 class="mb-1 line-clamp-2 text-sm font-semibold text-gray-900">
									{product.title}
								</h3>
								<p class="mb-2 text-lg font-bold text-gray-900">{product.price} –ª–≤</p>
								<div class="mb-1 text-xs text-gray-500">
									<div class="mb-1 flex items-center gap-1">
										<MapPin size={10} />
										<span>{product.location}</span>
									</div>
									<div class="flex items-center justify-between">
										<span>{product.seller}</span>
										<div class="flex items-center gap-1">
											<Star size={10} class="fill-yellow-400 text-yellow-400" />
											<span>{product.rating}</span>
										</div>
									</div>
								</div>
							</div>
						</a>
					{/each}
				</div>
				<div class="mt-8 text-center">
					<a
						href="/products?sort=nearby"
						class="bg-primary hover:bg-primary/90 inline-flex items-center gap-2 rounded-xl px-6 py-3 font-medium text-white transition-colors"
					>
						<MapPin size={16} />
						–í–∏–∂ –≤—Å–∏—á–∫–∏ –Ω–∞–±–ª–∏–∑–æ
					</a>
				</div>
			</Tabs.Content>
		</Tabs.Root>
	</div>
</section>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
